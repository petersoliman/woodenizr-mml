{% apply spaceless %}
    {% set cr = app.request.attributes.get('_route') %}
    {% set locale = app.request.get('_locale') %}

    <!doctype html>
    <html lang="{% if locale == '' %}en{% else %}{{ app.request.get('_locale') }}{% endif %}"
          dir="{{ locale == "ar" ? 'rtl': "ltr" }}">
    <head>
        <title>
            {% block title %}{% endblock %} | {{ getSiteSetting("website-title") }}
        </title>

        {% block criticalCSS %}{% endblock %}
        <style>
            {% set primaryColor = getSiteSetting("website-primary-color") %}
            {% set headerColor = getSiteSetting("website-header-color") %}
            {% set headerTextColor = getSiteSetting("website-header-text-color") %}
            {% set footerColor = getSiteSetting("website-footer-color") %}
            {% set footerTextColor = getSiteSetting("website-footer-text-color") %}
            :root {
                --primary-color: {{ primaryColor }} !important;
                --primary-color-rgb: {{ convertHexToRgb(primaryColor) }};
                --text-on-primary-color: #ffffff !important;
                --header-color: {{ headerColor }};
                --header-text-color: {{ headerTextColor }};
                --footer-color: {{ footerColor }};
                --footer-text-color: {{ footerTextColor }};
            }
            .m-header-topbar-logo{
                width: 220px !important;
            }
            .m-header-topbar-delivery{
                justify-content: end !important;
            }
            .m-header-topbar-logo a svg{
                max-width: 100%;
            }
            .m-header{
                background-color: var(--header-color) !important;
            }
            .m-footer{
                background-color: var(--footer-color) !important;
            }
            .m-header-topbar-icon svg path{
                fill: var(--header-text-color) !important;
            }
            .m-header-topbar-delivery-dropdown-button {
                color:  var(--header-text-color) !important;
            }
            .m-footer-widget-title,
            .m-footer-widget-content,
            .m-footer-widget-content a{
                color: var(--footer-text-color) !important;
            }
            .m-footer-widget-content-social-icons svg path{
                fill: var(--footer-text-color) !important;
            }
        </style>

        <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        
        {# Performance & Core Web Vitals #}
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        
        {# Security Headers #}
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
        
        {# Mobile App Meta Tags - Basic mobile support #}
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="apple-mobile-web-app-title" content="{{ getSiteSetting('website-title') ?? 'Woodenizr' }}">
        
        <meta property="og:site_name"
              content="{{ getSiteSetting("website-title") }}"/>
        {% block stylesheets %}{% endblock %}

        {% include "fe/_favicon.html.twig" %}
        {% block metaTag %}{% endblock %}

        {# Organization Schema for brand recognition #}
        {% if app.request.get('_route') starts with 'fe_' %}
            <script type="application/ld+json">
                {
                    "@context": "https://schema.org",
                    "@type": "Organization",
                    "name": "{{ getSiteSetting('website-title') ?? 'Woodenizr' }}",
                    "url": "{{ app.request.getSchemeAndHttpHost() }}",
                    "logo": "{{ app.request.getSchemeAndHttpHost() }}/logo.png",
                    "description": "Premium wooden products and furniture for your home and office",
                    "foundingDate": "2020",
                    "contactPoint": {
                        "@type": "ContactPoint",
                        "contactType": "customer service",
                        "availableLanguage": ["English", "Arabic"]
                    }
                }
            </script>
        {% endif %}

        {# SITE SETTINGS #}
        {% if 'Google' not in app.request.headers.get('User-Agent') %}
            {{ render(controller("App\\CMSBundle\\Controller\\FrontEnd\\SiteSettingController::siteSettingHead") ) }}
        {% endif %}
        {# END SITE SETTINGS #}
    </head>

    <body>
    {% if 'Google' not in app.request.headers.get('User-Agent') %}
        {{ render(controller("App\\CMSBundle\\Controller\\FrontEnd\\SiteSettingController::siteSettingBody") ) }}
    {% endif %}

    {% include 'fe/_header.html.twig' %}

    <div class="m-body">
        <div class="l-backdrop ui-backdrop" data-m-body-backdrop="true"></div>
        {% block content %}{% endblock %}
    </div>
    {% block modals %}{% endblock %}

    {{ render(controller('App\\HomeBundle\\Controller\\HeaderFooterController::footer')) }}
    {% include 'fe/_modals.html.twig' %}
    <div class="l-toasts" data-toasts="true"></div>

    {% include 'fe/_global_variables.html.twig' %}
    {% block javascripts %}
    {% endblock %}
    </body>
    </html>
{% endapply %}