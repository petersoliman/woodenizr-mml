{% extends 'adminTemplate/base.html.twig' %}
{% set page_title %}Group Update ({{ products|length }} Product){% endset %}

{% block breadcrumb %}
    <div class="breadcrumb-line">
        <ul class="breadcrumb">
            <li><a href="{{ path('dashboard') }}"><i class="icon-home2 position-left"></i>Dashboard</a></li>
            <li><a href="{{ path('product_group_update_index') }}">Group Update List</a></li>
            <li class="active">{{ page_title }}</li>
        </ul>
    </div>
{% endblock %}
{% block body -%}
    <div class="panel panel-flat">
        <div class="panel-body">
            <div class="tabbable tab-content-bordered ">
                <ul class="nav nav-tabs nav-tabs-highlight">
                    <li class="active"><a href="#panel-1" data-toggle="tab">Options</a></li>
                    {#                    <li><a href="#panel-3" data-toggle="tab">Promotion Price and Expiry date</a></li> #}
                    <li><a href="#panel-4" data-toggle="tab">Description</a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane has-padding  has-padding active" id="panel-1">
                        <form role="form" method="POST" action="{{ path('product_group_update_action_update') }}">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" id="publish" class="styled" name="data[publish]" value="1" data-deselect-when-select="#unpublish">
                                                Published
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" class="styled" id="unpublish" name="data[unpublish]" value="1" data-deselect-when-select="#publish">
                                                Not Published
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" class="styled" id="featured" name="data[featured]" value="1" data-deselect-when-select="#notFeatured">
                                                Featured
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" class="styled" id="notFeatured" name="data[notFeatured]" value="1" data-deselect-when-select="#featured">
                                                Not Featured
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" class="styled" id="newArrival" name="data[newArrival]" value="1" data-deselect-when-select="#notNewArrival">
                                                New Arrival

                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" class="styled" id="notNewArrival" name="data[notNewArrival]" value="1" data-deselect-when-select="#newArrival">
                                                Not New Arrival
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-footer">
                                <div class="row">
                                    <div class="col-sm-12 text-right">
                                        <input type="hidden" name="type" value="checkbox" />
                                        <input type="hidden" class="action" name="action" value="saveAndExit" />

                                        <button type="submit" class="btn btn-warning action-btn" value="saveAndExit">Update and exit</button>
                                        <button type="submit" class="btn btn-primary ml-10 action-btn" value="saveAndNext">Update and continue on the selected list</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    {#                    <div class="tab-pane has-padding has-padding fade" id="panel-3"> #}
                    {#                        <form method="POST" action="{{ path('product_group_update_action_update') }}"> #}

                    {#                            <div class="checkbox checkbox-left checkbox-switchery"> #}
                    {#                                <label> #}
                    {#                                    <input type="checkbox" class="switchery" name="data[removeDiscount]" id="removeDiscount" value="1"> #}
                    {#                                    Remove promotion price and expiry date #}
                    {#                                </label> #}
                    {#                            </div> #}
                    {#                            <div class="row"> #}
                    {#                                <div class="col-md-6"> #}
                    {#                                    <div class="form-group"> #}
                    {#                                        <label for="promotionDiscount">Promotion discount (%)</label> #}
                    {#                                        <div class="input-group"> #}
                    {#                                            <input type="number" id="promotionDiscount" name="data[discount]" min="0" class="form-control"> #}
                    {#                                            <span class="input-group-addon">%</span> #}
                    {#                                        </div> #}
                    {#                                    </div> #}
                    {#                                </div> #}
                    {#                                <div class="col-md-6"> #}
                    {#                                    <div class="form-group"> #}
                    {#                                        <label for="promotionExpiry">Promotion expiry date</label> #}
                    {#                                        <input type="text" class="form-control datepicker-future" name="data[expiryDate]" id="promotionExpiry" placeholder="Promotion expiry date"> #}
                    {#                                    </div> #}
                    {#                                </div> #}
                    {#                            </div> #}
                    {#                            <div class="panel-footer"> #}
                    {#                                <div class="row"> #}
                    {#                                    <div class="col-sm-12 text-right"> #}
                    {#                                        <input type="hidden" name="type" value="promotion"/> #}
                    {#                                        <input type="hidden" class="action" name="action" value="saveAndExit"/> #}

                    {#                                        <button type="submit" class="btn btn-warning action-btn" value="saveAndExit">Update and exit</button> #}
                    {#                                        <button type="submit" class="btn btn-primary ml-10 action-btn" value="saveAndNext">Update and continue on the selected list</button> #}
                    {#                                    </div> #}
                    {#                                </div> #}
                    {#                            </div> #}
                    {#                        </form> #}
                    {#                    </div> #}
                    <div class="tab-pane has-padding fade" id="panel-4">
                        {#<div class="checkbox checkbox-left checkbox-switchery">
                            <label>
                                <input type="checkbox" id="disabledAll" class="switchery">
                                <strong>Disable All</strong>
                            </label>
                        </div>#}
                        <div class="content-divider content-divider-muted text-muted">
                            <span></span>
                        </div>
                        <form method="POST" action="{{ path('product_group_update_action_update') }}">
                            <div class="checkbox checkbox-left checkbox-switchery">
                                <label>
                                    <input type="checkbox" id="disabledDescription" name="data[disabledDescription]" class="switchery">
                                    Disable Description
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="dynamic_pagetype_content" class="required">Description</label>
                                <textarea id="dynamic_pagetype_content" name="data[description]" class="ckeditor"></textarea>
                            </div>
                            <div class="content-divider content-divider-muted text-muted">
                                <span></span>
                            </div>
                            {#<div class="checkbox checkbox-left checkbox-switchery">
                                <label>
                                    <input type="checkbox" id="disabledBrief" name="data[disabledBrief]" class="switchery">
                                    Disable Brief
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="dynamic_pagetype_brief" class="required">Brief</label>
                                <textarea id="dynamic_pagetype_brief" name="data[brief]" class="form-control"></textarea>
                            </div>#}
                            <div class="panel-footer">
                                <div class="row">
                                    <div class="col-sm-12 text-right">
                                        <input type="hidden" name="type" value="content" />
                                        <input type="hidden" class="action" name="action" value="saveAndExit" />

                                        <button type="submit" class="btn btn-warning action-btn" value="saveAndExit">Update and exit</button>
                                        <button type="submit" class="btn btn-primary ml-10 action-btn" value="saveAndNext">Update and continue on the selected list</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% set productSelected = app.request.session.get('productSelected') %}
    <div class="panel panel-flat">
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>SKU</th>
                        <th>Title</th>
                        <th>Image</th>
                        <th>Category</th>
                        <th>Created</th>
                        <th>Published</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for product in products %}
                        <tr>
                            <td>{{ product.id }}</td>
                            <td>{% if product.sku %}{{ product.sku|pn_json_encode }}{% else %}N/A{% endif %}</td>
                            <td>{{ product.title|pn_json_encode }}</td>
                            <td>
                                {% if product.mainImage %}
                                    <div class='thumb' style='width: 58px; height: 58px;object-fit: cover;'>
                                        <a href='{{ asset(product.mainImage.assetPath) }}' data-popup='lightbox'><img src='{{ asset(product.mainImage.assetPath)|webp(60) }}' alt='' style='width: 58px; height: 58px;object-fit: cover;'><span class='zoom-image'><i class='icon-plus2'></i></span></a>
                                    </div>
                                {% else %}
                                    --
                                {% endif %}
                            </td>
                            {#                            <td>{{ product.minPrice }}</td> #}
                            <td>{{ product.category.title|pn_json_encode }}</td>
                            <td>{% if product.created %}{{ product.created|dateTimeFormat }}{% else %}--{% endif %}</td>
                            <td>
                                {% if product.publish == true %}
                                    <div class="label label-success">Yes</div>
                                {% else %}
                                    <div class="label label-danger">No</div>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('admin/js/plugins/forms/selects/select2.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/forms/styling/uniform.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/forms/styling/switchery.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/pickers/pickadate/picker.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/pickers/pickadate/picker.date.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/forms/validation/validate.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/pages/form_validation.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/ckeditor/ckeditor.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/notifications/sweet_alert.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/pages/components_thumbnails.js') }}"></script>
    <script type="text/javascript" src="{{ asset('admin/js/plugins/media/fancybox.min.js') }}"></script>
    <script>
        $(".action-btn").click(function (e) {
            $(".action").val($(this).val());
        });
        $("form").submit(function (e) {
            e.preventDefault();

            $this = $(this);
            console.log($(this));
            swal({
                title: "Are you sure?",
                text: "Are you sure you want to update {{ products|length }} product(s) ?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#EF5350",
                confirmButtonText: "Yes",
                cancelButtonText: "No",
                closeOnConfirm: false,
                closeOnCancel: true
            }, function (isConfirm) {
                if (isConfirm) {
                    swal({
                        title: "Please wait ...",
                        type: "success",
                        showConfirmButton: false
                    });
                    $this[0].submit();
                    return;
                }
            });
        });

        $(document).ready(function () {
            var yesterday = new Date((new Date()).valueOf() - 1000 * 60 * 60 * 24);
            $('.datepicker-future').pickadate({
                format: 'dd/mm/yyyy',
                formatSubmit: 'dd/mm/yyyy',
                disable: [
                    {from: [0, 0, 0], to: yesterday}
                ]
            });

            function changeSwitchery(element, checked) {
                if ((element.is(':checked') && checked == false) || (!element.is(':checked') && checked == true)) {
                    element.trigger('click');
                }
            }

            $('#disabledAll').change(function () {
                if ($(this).is(":checked")) {
                    $('#disabledDescription, #disabledBrief').attr('checked', true);
                    changeSwitchery($('#disabledDescription'), true);
                    changeSwitchery($('#disabledBrief'), true);
                    changeSwitchery($('#disabledReturnExchange'), true);

                } else {
                    $('#disabledDescription, #disabledBrief').attr('checked', false);
                    changeSwitchery($('#disabledDescription'), false);
                    changeSwitchery($('#disabledBrief'), false);
                }
            });
            $('#disabledDescription').change(function () {
                if ($(this).is(":checked")) {
                    CKEDITOR.instances['dynamic_pagetype_content'].setReadOnly(true);
                    CKEDITOR.instances['dynamic_pagetype_content'].document.getBody().setStyle('background-color', '#EEEEEE');
                } else {
                    CKEDITOR.instances['dynamic_pagetype_content'].setReadOnly(false);
                    CKEDITOR.instances['dynamic_pagetype_content'].document.getBody().setStyle('background-color', '#FFFFFF');
                }
            });
            $('#disabledBrief').change(function () {
                console.log($(this).is(":checked"));
                if ($(this).is(":checked")) {
                    $('#dynamic_pagetype_brief').attr("disabled", "disabled");
                } else {
                    $('#dynamic_pagetype_brief').removeAttr("disabled");
                }
            });


            $('#removeDiscount').change(function () {
                if ($(this).is(":checked")) {
                    $('#promotionDiscount').attr('disabled', true);
                    $('#promotionExpiry').attr('disabled', true);
                } else {
                    $('#promotionDiscount').attr('disabled', false);
                    $('#promotionExpiry').attr('disabled', false);
                }
            });

            $('[data-deselect-when-select]').click(function () {
                let deselectElement = $(this).data("deselect-when-select");
                let element = $(deselectElement).prop("checked", false);
                $.uniform.update(element)
            })
        });

    </script>
{% endblock %}